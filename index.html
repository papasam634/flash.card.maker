<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å–®å­—ç‰¹è¨“ç­ (ç©©å®šä¿®å¾©ç‰ˆ)</title>
    <!-- å˜—è©¦è¼‰å…¥ Tailwindï¼Œå¤±æ•—ä¹Ÿä¸æœƒå½±éŸ¿åŠŸèƒ½ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* === æ ¸å¿ƒæ¨£å¼ (ä¿è­‰åŠŸèƒ½æ­£å¸¸) === */
        /* å¼·åˆ¶éš±è—ï¼Œå„ªå…ˆç´šæœ€é«˜ */
        .hidden-force { display: none !important; }
        
        /* é è¨­é¡¯ç¤ºæ¨£å¼ (è‹¥ Tailwind æ²’è¼‰å…¥) */
        body { font-family: sans-serif; background: #f3f4f6; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { background: white; width: 100%; max-width: 800px; min-height: 600px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; display: flex; flex-direction: column; }
        
        /* åˆ†é æŒ‰éˆ•æ¨£å¼ */
        .nav-btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px; transition: 0.2s; }
        .nav-btn.active { background-color: #2563eb; color: white; } /* è—è‰² */
        .nav-btn.inactive { background-color: #f3f4f6; color: #4b5563; } /* ç°è‰² */
        .nav-btn.inactive:hover { background-color: #e5e7eb; }

        /* è¼¸å…¥æ¡†éŒ¯èª¤å‹•ç•« */
        .shake { animation: shake 0.3s ease-in-out; border-color: #ef4444 !important; color: #ef4444 !important; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body>

    <div class="container">
        
        <!-- é ‚éƒ¨å°èˆªåˆ— -->
        <div style="padding: 16px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; background: white;">
            <h1 style="margin: 0; font-size: 20px; color: #374151;">ğŸ”€ å–®å­—ç‰¹è¨“ç­</h1>
            
            <!-- åˆ†é æŒ‰éˆ• -->
            <div style="display: flex; gap: 8px;">
                <button id="btn-manage" class="nav-btn active">1. å–®å­—ç®¡ç†</button>
                <button id="btn-quiz" class="nav-btn inactive">2. éš¨æ©Ÿæ¸¬é©—</button>
            </div>
        </div>

        <!-- é é¢ 1: å–®å­—ç®¡ç† -->
        <div id="view-manage" style="padding: 24px; flex: 1; display: flex; flex-direction: column;">
            
            <!-- æ–°å¢è¡¨å–® -->
            <div style="background: #eff6ff; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dbeafe;">
                <h3 style="margin-top: 0; margin-bottom: 12px; color: #1e40af;">â• æ–°å¢å–®å­—</h3>
                <form id="add-form" style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <input id="input-spelling" placeholder="è‹±æ–‡ (Apple)" required style="flex: 2; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px; min-width: 120px;">
                    <input id="input-meaning" placeholder="ä¸­æ–‡ (è˜‹æœ)" required style="flex: 2; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px; min-width: 120px;">
                    <input id="input-pos" placeholder="è©æ€§ (n.)" required style="flex: 1; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px; min-width: 60px;">
                    <button type="submit" style="flex: 1; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; padding: 8px;">æ–°å¢</button>
                </form>
            </div>

            <!-- åˆ—è¡¨ -->
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span style="color: #6b7280; font-size: 14px;">ç¸½å–®å­—é‡ï¼š<span id="word-count" style="font-weight: bold;">0</span></span>
                <button id="btn-reset" style="background: none; border: none; color: #ef4444; cursor: pointer; font-size: 12px; text-decoration: underline;">æ¸…ç©ºè³‡æ–™</button>
            </div>

            <div style="flex: 1; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; position: relative;">
                <div style="overflow-y: auto; height: 100%; max-height: 400px;">
                    <table style="width: 100%; border-collapse: collapse; text-align: left;">
                        <thead style="background: #f9fafb; position: sticky; top: 0;">
                            <tr>
                                <th style="padding: 12px; border-bottom: 1px solid #e5e7eb;">è‹±æ–‡</th>
                                <th style="padding: 12px; border-bottom: 1px solid #e5e7eb;">ä¸­æ–‡</th>
                                <th style="padding: 12px; border-bottom: 1px solid #e5e7eb;">è©æ€§</th>
                                <th style="padding: 12px; border-bottom: 1px solid #e5e7eb; text-align: right;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="word-list-body"></tbody>
                    </table>
                    <div id="list-empty-msg" style="display: none; text-align: center; padding: 40px; color: #9ca3af;">æš«ç„¡å–®å­—</div>
                </div>
            </div>
        </div>

        <!-- é é¢ 2: éš¨æ©Ÿæ¸¬é©— -->
        <div id="view-quiz" class="hidden-force" style="padding: 24px; flex: 1; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
            
            <!-- é€²åº¦æ¢ -->
            <div style="width: 100%; height: 4px; background: #e5e7eb; margin-bottom: 8px; border-radius: 2px;">
                <div id="progress-bar" style="width: 0%; height: 100%; background: #3b82f6; transition: width 0.3s;"></div>
            </div>
            <div style="font-size: 12px; color: #6b7280; margin-bottom: 40px;">æœ¬è¼ªå‰©é¤˜ï¼š<span id="queue-count">0</span> é¡Œ</div>

            <!-- æ¸¬é©—å¡ç‰‡ -->
            <div id="quiz-card" style="width: 100%; max-width: 400px; margin: 0 auto;">
                <div style="margin-bottom: 20px;">
                    <span id="quiz-pos" style="background: #e0e7ff; color: #4338ca; padding: 2px 8px; border-radius: 4px; font-size: 12px;">è©æ€§</span>
                    <h2 id="quiz-meaning" style="font-size: 32px; margin: 16px 0; color: #1f2937;">(é¡Œç›®)</h2>
                </div>

                <div style="position: relative; margin-bottom: 20px;">
                    <input id="quiz-input" type="text" placeholder="è¼¸å…¥æ‹¼å­—..." autocomplete="off"
                           style="width: 100%; text-align: center; font-size: 24px; border: none; border-bottom: 2px solid #d1d5db; padding: 10px; outline: none; background: transparent;">
                    <div id="quiz-msg" style="height: 20px; margin-top: 8px; font-size: 14px; font-weight: bold;"></div>
                </div>

                <button id="btn-next" class="hidden-force" style="width: 100%; background: #22c55e; color: white; font-size: 18px; font-weight: bold; padding: 12px; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    ä¸‹ä¸€é¡Œ â”
                </button>
            </div>

            <!-- ç„¡é¡Œç›®æç¤º -->
            <div id="quiz-empty-msg" class="hidden-force">
                <p style="font-size: 18px; color: #6b7280;">é¡Œåº«æ˜¯ç©ºçš„ï¼</p>
                <button id="btn-go-manage" style="color: #2563eb; background: none; border: none; cursor: pointer; text-decoration: underline;">å›ç®¡ç†é æ–°å¢</button>
            </div>
        </div>
    </div>

    <script>
        // --- å…¨åŸŸè®Šæ•¸ ---
        const STORAGE_KEY = 'vocab_app_final';
        let words = [];
        let quizQueue = [];
        let currentWord = null;

        // --- DOM å…ƒç´ ç·©å­˜ ---
        const el = {
            btnManage: document.getElementById('btn-manage'),
            btnQuiz: document.getElementById('btn-quiz'),
            viewManage: document.getElementById('view-manage'),
            viewQuiz: document.getElementById('view-quiz'),
            inputSpelling: document.getElementById('input-spelling'),
            addForm: document.getElementById('add-form'),
            quizInput: document.getElementById('quiz-input')
        };

        // --- ç¨‹å¼é€²å…¥é» ---
        window.onload = function() {
            // 1. ç¶å®šåˆ†é æŒ‰éˆ• (ä½¿ç”¨ onclick å±¬æ€§æœ€ç›´æ¥)
            el.btnManage.onclick = function() { goToTab('manage'); };
            el.btnQuiz.onclick = function() { goToTab('quiz'); };
            document.getElementById('btn-go-manage').onclick = function() { goToTab('manage'); };

            // 2. ç¶å®šå…¶ä»–æŒ‰éˆ•
            el.addForm.onsubmit = handleAddWord;
            document.getElementById('btn-reset').onclick = resetData;
            document.getElementById('btn-next').onclick = nextQuestion;

            // 3. ç¶å®šè¼¸å…¥æ¡†é‚è¼¯
            el.quizInput.oninput = checkAnswer;
            el.quizInput.onkeydown = function(e) {
                if (e.key === 'Enter' && !document.getElementById('btn-next').classList.contains('hidden-force')) {
                    nextQuestion();
                }
            };

            // 4. è¼‰å…¥è³‡æ–™
            loadData();
        };

        // --- åˆ†é åˆ‡æ›é‚è¼¯ (æœ€æ ¸å¿ƒä¿®å¾©) ---
        function goToTab(tabName) {
            if (tabName === 'manage') {
                // é¡¯ç¤ºç®¡ç†é 
                el.viewManage.classList.remove('hidden-force');
                el.viewManage.style.display = 'flex'; // ç¢ºä¿ flex ä½ˆå±€
                
                // éš±è—æ¸¬é©—é 
                el.viewQuiz.classList.add('hidden-force');
                el.viewQuiz.style.display = 'none';

                // æ›´æ–°æŒ‰éˆ•æ¨£å¼
                el.btnManage.className = 'nav-btn active';
                el.btnQuiz.className = 'nav-btn inactive';
                
                // èšç„¦
                setTimeout(() => el.inputSpelling.focus(), 50);

            } else {
                // é¡¯ç¤ºæ¸¬é©—é 
                el.viewQuiz.classList.remove('hidden-force');
                el.viewQuiz.style.display = 'flex'; // ç¢ºä¿ flex ä½ˆå±€

                // éš±è—ç®¡ç†é 
                el.viewManage.classList.add('hidden-force');
                el.viewManage.style.display = 'none';

                // æ›´æ–°æŒ‰éˆ•æ¨£å¼
                el.btnManage.className = 'nav-btn inactive';
                el.btnQuiz.className = 'nav-btn active';

                // åˆå§‹åŒ–æ¸¬é©—
                initQuiz();
            }
        }

        // --- è³‡æ–™é‚è¼¯ ---
        function loadData() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (raw) words = JSON.parse(raw);
            } catch (e) {
                console.error("è®€å–éŒ¯èª¤ï¼Œé‡ç½®è³‡æ–™");
                words = [];
            }
            renderList();
        }

        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(words));
            renderList();
        }

        function handleAddWord(e) {
            e.preventDefault();
            const s = el.inputSpelling.value.trim();
            const m = document.getElementById('input-meaning').value.trim();
            const p = document.getElementById('input-pos').value.trim();
            
            if (!s || !m) return;

            words.unshift({ id: Date.now(), s, m, p }); // s=spelling, m=meaning, p=pos
            saveData();

            // æ¸…ç©ºä¸¦èšç„¦
            e.target.reset();
            el.inputSpelling.focus();
            
            // å¦‚æœä½‡åˆ—ç©ºäº†ï¼Œè¦–ç‚ºæ–°ä¸€è¼ªå¯èƒ½è¦åŠ é€²å» (ç°¡å–®è™•ç†ï¼šæ¸…ç©ºä½‡åˆ—å¼·åˆ¶é‡æ´—)
            if(quizQueue.length === 0) quizQueue = [];
        }

        function deleteWord(id) {
            words = words.filter(w => w.id !== id);
            // åŒæ­¥ç§»é™¤ä½‡åˆ—ä¸­çš„è©²å­—
            quizQueue = quizQueue.filter(w => w.id !== id);
            saveData();
        }

        function resetData() {
            if(!confirm('ç¢ºå®šæ¸…ç©ºæ‰€æœ‰å–®å­—ï¼Ÿ')) return;
            words = [];
            quizQueue = [];
            saveData();
        }

        function renderList() {
            const tbody = document.getElementById('word-list-body');
            tbody.innerHTML = '';
            document.getElementById('word-count').innerText = words.length;

            if (words.length === 0) {
                document.getElementById('list-empty-msg').style.display = 'block';
            } else {
                document.getElementById('list-empty-msg').style.display = 'none';
                words.forEach(w => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td style="padding:12px; color:#2563eb; font-family:monospace; font-size:16px;">${w.s}</td>
                        <td style="padding:12px;">${w.m}</td>
                        <td style="padding:12px;"><span style="background:#f3f4f6; padding:2px 6px; border-radius:4px; font-size:12px;">${w.p}</span></td>
                        <td style="padding:12px; text-align:right;">
                            <button onclick="deleteWord(${w.id})" style="color:#9ca3af; background:none; border:none; cursor:pointer; font-weight:bold; font-size:16px;">âœ•</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            }
        }

        // --- æ¸¬é©—é‚è¼¯ ---
        function initQuiz() {
            const card = document.getElementById('quiz-card');
            const emptyMsg = document.getElementById('quiz-empty-msg');

            if (words.length === 0) {
                card.classList.add('hidden-force');
                emptyMsg.classList
